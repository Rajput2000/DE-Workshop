id: 04_postgres_taxi_backfill
namespace: homework
description: |
  Backfill flow using ForEach to process multiple year-month-taxi combinations

tasks:
  - id: foreach_combinations
    type: io.kestra.plugin.core.flow.ForEach
    values: |
      [
        {"taxi": "yellow", "year": "2021", "month": "01"},
        {"taxi": "yellow", "year": "2021", "month": "02"},
        {"taxi": "yellow", "year": "2021", "month": "03"},
        {"taxi": "yellow", "year": "2021", "month": "04"},
        {"taxi": "yellow", "year": "2021", "month": "05"},
        {"taxi": "yellow", "year": "2021", "month": "06"},
        {"taxi": "yellow", "year": "2021", "month": "07"},
        {"taxi": "green", "year": "2021", "month": "01"},
        {"taxi": "green", "year": "2021", "month": "02"},
        {"taxi": "green", "year": "2021", "month": "03"},
        {"taxi": "green", "year": "2021", "month": "04"},
        {"taxi": "green", "year": "2021", "month": "05"},
        {"taxi": "green", "year": "2021", "month": "06"},
        {"taxi": "green", "year": "2021", "month": "07"}
      ]
    tasks:
      - id: process_data
        type: io.kestra.plugin.core.flow.Subflow
        namespace: homework
        flowId: 04_postgres_taxi
        inputs:
          taxi: "{{taskrun.value.taxi}}"
          year: "{{taskrun.value.year}}"
          month: "{{taskrun.value.month}}"
